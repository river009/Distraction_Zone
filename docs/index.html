<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‚¬ë§íƒ€ì„ ê²Œì„ ë§Œë“¤ê¸°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            overflow: hidden;
            height: 100vh;
        }
        #gameContainer { display: flex; height: 100vh; }
        #gameCanvas {
            background: #2c3e50;
            border: 2px solid #444;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        #sidePanel {
            width: 320px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-left: 2px solid #444;
        }
        .status-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-title {
            font-weight: 700;
            font-size: 14px;
            color: #3498db;
            margin-bottom: 10px;
        }
        .emotion-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        .emotion-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .controls {
            font-size: 12px;
            line-height: 1.6;
            color: #bdc3c7;
        }
        .game-title {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }
        .chapter-info {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
        }
        .chapter-title { color: #3498db; font-weight: 600; font-size: 16px; }
        .chapter-desc { color: #ecf0f1; font-size: 12px; margin-top: 5px; }
        #messageBox {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 340px;
            background: transparent;
            border: none;
            border-radius: 8px;
            padding: 0;
            color: #ecf0f1;
            font-weight: 600;
            display: none;
            z-index: 100;
            box-shadow: none;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- ë§í’ì„  & NPC ìŠ¤íƒ€ì¼ ì „ì²´ ì ìš© --- */
        .msg-bubble {
            /*animation: popAppear 0.46s cubic-bezier(.37,1.65,.71,.71), bubbleWiggle 2.5s 0.25s infinite;*/
            animation: popAppear 0.46s cubic-bezier(.37,1.65,.71,.71);
            background: rgba(30,45,75,0.93);
            border-radius: 16px 24px 20px 18px/22px 21px 16px 24px;
            box-shadow: 0 8px 28px #0006, 0 0px 0px #fff3 inset;
            padding: 20px 18px 18px 18px;
            margin-bottom: 8px;
            border: 2px solid #1f6ce6;
            position: relative;
            max-width: 440px;
            color: #f3f7fb;
            font-size: 15px;
            transition: box-shadow .18s;
        }
        .msg-bubble:last-child { margin-bottom:0; }

        /* NPCë³„ í…Œë§ˆ */
        .npc-wugi { border-color: #a3d8f4; background: rgba(43, 87, 174, 0.94);}
        .npc-yeji { border-color: #e74c3c; background: rgba(174, 60, 60, 0.92);}
        .npc-ryu  { border-color: #f8c471; background: rgba(180,145,70,0.91);}
        .npc-system { border-color: #7f8c8d; background: rgba(50,55,65,0.96);}
        .npc-player { border-color: #51f06b; background: rgba(40,90,50,0.95);}

        .npc-profile {
            width: 40px; height: 40px;
            margin-right: 13px;
            border-radius: 11px;
            border: 2.5px solid #fff6;
            background: #222c;
            image-rendering: pixelated;
            box-shadow: 0 2px 12px #0008;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
            animation: avatarPop 0.5s;
        }
        .npc-profile img { width: 80%; height: 80%; object-fit: contain; }

        @keyframes bubbleWiggle {
            0%, 100% { filter: blur(0px) brightness(1);}
            7%   { transform: scale(1.03,0.98) rotate(-2deg);}
            12%  { transform: scale(0.98,1.02) rotate(2deg);}
            18%  { filter: blur(1px) brightness(1.05);}
            40%  { transform: scale(1.01,1.01);}
            50%  { filter: blur(0.5px);}
            62%  { transform: scale(1,1) rotate(0deg);}
        }
        @keyframes avatarPop {
            0%   { transform: scale(0.5) rotate(-10deg); opacity: 0;}
            70%  { transform: scale(1.12) rotate(5deg);}
            100% { transform: scale(1)   rotate(0); opacity: 1;}
        }
        @keyframes popAppear {
            0%   { transform: scale(0.7) translateY(38px); opacity: 0;}
            70%  { transform: scale(1.08) translateY(-4px);}
            100% { transform: scale(1)   translateY(0); opacity: 1;}
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="sidePanel">
            <div class="game-title">
                <h2>ë”´ìƒê° ê¸ˆì§€êµ¬ì—­</h2>
                <div style="font-size: 12px; color: #3498db;">ì¶œê·¼ê¸¸ íƒˆì¶œ RPG</div>
            </div>
            <div class="chapter-info">
                <div class="chapter-title">1ì¥: ì¶œê·¼ê¸¸ì˜ ë”´ìƒê°</div>
                <div class="chapter-desc">ì§€í•˜ì² ì—­ì—ì„œ ì‚¬ë¬´ì‹¤ê¹Œì§€, ë”´ìƒê°ì„ ìˆ˜ì§‘í•˜ë©° ì¶œê·¼í•˜ì„¸ìš”</div>
                <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>
            </div>
            <div class="status-section">
                <div class="status-title">ìˆ˜ì§‘í•œ ë”´ìƒê°</div>
                <div id="emotionList">
                    <div style="color: #7f8c8d; font-size: 12px;">ì•„ì§ ë”´ìƒê°ì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>
            <div class="status-section">
                <div class="status-title">ì¡°ì‘ë²•</div>
                <div class="controls">
                    <div>â†‘â†“â†â†’ : ê±·ê¸°</div>
                    <div>Enter : ë©”ì‹œì§€ ë„˜ê¸°ê¸°</div>
                    <div>â˜• ğŸš‡ ğŸ“± : ë”´ìƒê° ìˆ˜ì§‘</div>
                    <div>ğŸ¢ : ì‚¬ë¬´ì‹¤ ë„ì°©</div>
                </div>
            </div>
            <div class="status-section">
                <div class="status-title">ì¶œê·¼ ìƒí™©</div>
                <div class="controls">
                    <div>í˜„ì¬ ìœ„ì¹˜: <span id="playerPos">ì§€í•˜ì² ì—­</span></div>
                    <div>ë”´ìƒê° ìˆ˜ì§‘: <span id="collectCount">0/5</span></div>
                    <div>ì¶œê·¼ ì§„í–‰ë„: <span id="timeInfo">8:00 AM</span></div>
                </div>
            </div>
        </div>
    </div>
    <div id="messageBox"></div>
    <script>
        // ê²Œì„ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const TILE_SIZE = 32;
        const MAP_WIDTH = 25;
        const MAP_HEIGHT = 19;

        // ê²Œì„ ìƒíƒœ
        const gameState = {
            player: { x: 12, y: 17, char: 'ğŸš¶â€â™‚ï¸' },
            emotions: [],
            collectedEmotions: [],
            totalEmotions: 5,
            gameComplete: false,
            currentTime: '8:00 AM',
            messageQueue: [],
            currentMessageIndex: 0,
            yejiComplaintShown: false,
            inOffice: false,
            pcOn: false,
            messengerOpen: false,
            chatWithSua: false,
            chaecheNPC: null,
            ryuEventTriggered: false,
            switchedToSpace: false
        };

        // ì¶œê·¼ê¸¸ ë”´ìƒê° íƒ€ì… ì •ì˜
        const emotionTypes = [
            { type: 'ì»¤í”¼ ìƒê°', icon: 'â˜•', color: '#8b4513', desc: 'ì¹´í˜ë¼ë–¼ê°€ ë§ˆì‹œê³  ì‹¶ë‹¤...' },
            { type: 'ì§€í•˜ì²  í”¼ë¡œ', icon: 'ğŸš‡', color: '#34495e', desc: 'ë˜ ì§€ì—°ì´ë„¤, ì–¸ì œ ë„ì°©í•˜ì§€?' },
            { type: 'íœ´ëŒ€í° í™•ì¸', icon: 'ğŸ“±', color: '#3498db', desc: 'ë©”ì‹œì§€ ì™”ë‚˜? SNS ì¢€ ë´ì•¼ì§€' },
            { type: 'ì ì‹¬ ë©”ë‰´', icon: 'ğŸš', color: '#e67e22', desc: 'ì˜¤ëŠ˜ ì ì‹¬ì€ ë­˜ ë¨¹ì„ê¹Œ?' },
            { type: 'í‡´ê·¼ ê¸°ëŒ€', icon: 'ğŸ ', color: '#27ae60', desc: 'í‡´ê·¼í•˜ë©´ ë­í•˜ì§€? ì§‘ì— ê°€ê³  ì‹¶ë‹¤' }
        ];

        // íšŒì‚¬ ë”´ìƒê° íƒ€ì… ì •ì˜
        const officeEmotionTypes = [
            { type: 'íšŒì˜ ê±±ì •', icon: 'ğŸ˜°', color: '#e74c3c', desc: 'ì˜¤ëŠ˜ íšŒì˜ì—ì„œ ë­ë¼ê³  ë§í•˜ì§€?' },
            { type: 'ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤', icon: 'ğŸ˜¤', color: '#9b59b6', desc: 'ì¼ì´ ë„ˆë¬´ ë§ì•„... ì–¸ì œ ëë‚˜ì§€?' },
            { type: 'ë™ë£Œ ê´€ì°°', icon: 'ğŸ‘€', color: '#f39c12', desc: 'ì € ì‚¬ëŒì€ ë­í•˜ê³  ìˆì„ê¹Œ?' },
            { type: 'ê°„ì‹ ìƒê°', icon: 'ğŸª', color: '#e67e22', desc: 'ì„œëì— ê³¼ìê°€ ìˆì—ˆë‚˜?' },
            { type: 'ì§‘ ìƒê°', icon: 'ğŸ¡', color: '#2ecc71', desc: 'ì§‘ì—ì„œ ë„·í”Œë¦­ìŠ¤ ë³´ê³  ì‹¶ë‹¤...' }
        ];

        // íšŒì‚¬ ë§µ (10: ì±…ìƒ, 11: ë‚´ ìë¦¬, 12: ë³µì‚¬ê¸°, 13: í™”ì¥ì‹¤, 14: íšŒì˜ì‹¤)
        const officeMap = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,10,10,1,10,10,1,10,10,1,10,10,1,10,10,1,12,1,1,1,1,1,1,0],
            [0,1,10,10,1,10,10,1,10,10,1,10,10,1,10,10,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,10,10,1,10,10,1,10,10,1,10,10,1,10,10,1,1,1,1,1,14,14,1,0],
            [0,1,10,10,1,10,10,1,10,10,1,10,10,1,10,10,1,1,1,1,1,14,14,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,10,10,1,10,10,1,10,10,1,10,10,1,10,10,1,1,1,1,1,1,1,1,0],
            [0,1,10,10,1,10,10,1,10,10,1,10,10,1,10,10,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,11,10,1,10,10,1,10,10,1,10,10,1,10,10,1,1,1,13,1,1,1,1,0],
            [0,1,10,10,1,10,10,1,10,10,1,10,10,1,10,10,1,1,1,13,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]
        ];

        // ì˜ˆìœ ì¶œê·¼ê¸¸ ë§µ (6: ë‚˜ë¬´, 7: ì¹´í˜, 8: í¸ì˜ì , 9: ë²¤ì¹˜)
        const gameMap = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,6,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,6,0,0,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,0,0,7,0],
            [0,0,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,0,0,0],
            [0,0,1,0,6,0,0,9,0,0,0,1,1,1,0,0,8,0,0,0,1,0,0,0,0],
            [0,0,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,1,1,1,1,0,0,0,0],
            [0,0,0,0,1,1,5,5,5,5,5,5,5,5,5,5,5,1,1,0,0,0,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,0,6,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,0,1,0,0,0,6,0,2,1,1,1,2,0,0,0,0,0,1,0,0,0,0],
            [0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,9,0,0,0,1,0,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,6,0,0,0,0,1,2,1,0,0,0,0,6,0,0,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,4,4,4,4,4,4,4,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,4,4,4,1,4,4,4,0,0,0,0,0,0,0,0,0]
        ];

        // ë”´ìƒê° ì¡°ê° ì´ˆê¸°í™”
        function initEmotions() {
            let emotionIndex = 0;
            for (let y = 0; y < MAP_HEIGHT; y++) {
                for (let x = 0; x < MAP_WIDTH; x++) {
                    if (gameMap[y][x] === 2 && emotionIndex < emotionTypes.length) {
                        gameState.emotions.push({
                            x: x,
                            y: y,
                            ...emotionTypes[emotionIndex],
                            collected: false
                        });
                        emotionIndex++;
                    }
                }
            }
        }

        // í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬
        const keys = {};
        let isShowingMessage = false;
        window.movePlayerEnabled = true;

        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === 'Enter' && !gameState.switchedToSpace) {
                if (isShowingMessage) {
                    processNextMessage();
                } else if (gameState.inOffice) {
                    checkPCInteraction();
                }
            }
            if (e.key === ' ' && gameState.switchedToSpace) {
                e.preventDefault(); // ìŠ¤í˜ì´ìŠ¤ë°” ê¸°ë³¸ ë™ì‘ ë°©ì§€
                if (isShowingMessage) {
                    processNextMessage();
                } else if (gameState.inOffice) {
                    checkPCInteraction();
                }
            }
        });
        document.addEventListener('keyup', (e) => { keys[e.key] = false; });

        // ë©”ì‹œì§€ í ì²˜ë¦¬
        function processNextMessage() {
            // í˜„ì¬ ë©”ì‹œì§€ì˜ callback ì‹¤í–‰
            const currentMessage = gameState.messageQueue[gameState.currentMessageIndex];
            if (currentMessage && currentMessage.callback) {
                currentMessage.callback();
            }
            
            gameState.currentMessageIndex++;
            if (gameState.currentMessageIndex < gameState.messageQueue.length) {
                showQueuedMessage(gameState.messageQueue[gameState.currentMessageIndex]);
            } else {
                const messageBox = document.getElementById('messageBox');
                messageBox.style.display = 'none';
                isShowingMessage = false;
                gameState.messageQueue = [];
                gameState.currentMessageIndex = 0;
            }
        }
        // ë©”ì‹œì§€ íì— ì¶”ê°€
        function addToMessageQueue(messageData) {
            gameState.messageQueue = messageData;
            gameState.currentMessageIndex = 0;
            showQueuedMessage(messageData[0]);
        }
        // íì— ìˆëŠ” ë©”ì‹œì§€ í‘œì‹œ
        function showQueuedMessage(messageData) {
            const messageBox = document.getElementById('messageBox');
            let html = messageData.html;
            
            // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì „í™˜ëœ í›„ì—ëŠ” "Press Enter"ë¥¼ "Press Space"ë¡œ ë³€ê²½
            if (gameState.switchedToSpace) {
                html = html.replace(/Press Enter to continue\.\.\./g, 'Press Space to continue...');
            }
            
            messageBox.innerHTML = html;
            messageBox.style.display = 'block';
            isShowingMessage = true;
        }

        // í”Œë ˆì´ì–´ ì´ë™
        function movePlayer() {
            if (isShowingMessage) return;
            if (window.movePlayerEnabled === false) return;
            let newX = gameState.player.x;
            let newY = gameState.player.y;
            if (keys['ArrowUp'] || keys['w']) newY--;
            if (keys['ArrowDown'] || keys['s']) newY++;
            if (keys['ArrowLeft'] || keys['a']) newX--;
            if (keys['ArrowRight'] || keys['d']) newX++;
            if (newX >= 0 && newX < MAP_WIDTH && newY >= 0 && newY < MAP_HEIGHT) {
                const currentMap = gameState.inOffice ? officeMap : gameMap;
                const targetTile = currentMap[newY][newX];
                if (targetTile !== 0) {
                    gameState.player.x = newX;
                    gameState.player.y = newY;
                    updatePlayerPosition();
                    checkEmotionCollection();
                    if (!gameState.inOffice) {
                        checkOfficeReached();
                    }
                }
            }
        }

        // ë”´ìƒê° ìˆ˜ì§‘ ì²´í¬
        function checkEmotionCollection() {
            gameState.emotions.forEach(emotion => {
                if (!emotion.collected &&
                    emotion.x === gameState.player.x &&
                    emotion.y === gameState.player.y) {

                    emotion.collected = true;
                    gameState.collectedEmotions.push(emotion);

                    // ë©”ì‹œì§€ í ìƒì„±
                    let messages = [];
                    // ê¸°ë³¸ ë”´ìƒê° ë©”ì‹œì§€ (ì‹œìŠ¤í…œ ë§í’ì„ )
                    messages.push({
                        html: `
                            <div class="msg-bubble npc-system" style="display:flex;align-items:flex-start;">
                                <div class="npc-profile">
                                    <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23678be3'/><rect x='6' y='10' width='20' height='14' fill='%23d6e3fc'/></svg>" alt="ì‹œìŠ¤í…œ í”„ë¡œí•„">
                                </div>
                                <div>
                                    <div style="font-weight: bold; color: #3498db; font-size:15px;">SYSTEM</div>
                                    <div style="margin-top:2px;font-size: 14px;">
                                        ğŸ’­ "${emotion.type}" ë”´ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤!<br>
                                        <span style="color:#bdc3c7;">${emotion.desc}</span>
                                    </div>
                                </div>
                            </div>
                            <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                                Press Enter to continue...
                            </div>
                        `
                    });

                    // íœ´ëŒ€í° í™•ì¸ì¼ ë•Œ ì¶”ê°€ ë©”ì‹œì§€ë“¤
                    if (emotion.icon === 'ğŸ“±') {
                        // ì¸ìŠ¤íƒ€ ë¦´ìŠ¤ ë©”ì‹œì§€
                        messages.push({
                            html: `
                                <div class="msg-bubble npc-wugi" style="display:flex;align-items:flex-start;">
                                    <div class="npc-profile">
                                        <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23a3d8f4'/><rect x='7' y='9' width='18' height='18' fill='%23fff'/><rect x='11' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='18' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='14' y='21' width='4' height='2' fill='%23f6d7f2'/></svg>" alt="ìš°ê¸° í”„ë¡œí•„">
                                    </div>
                                    <div>
                                        <div style="font-weight: bold; color: #a3d8f4; font-size:15px;">íš¨ì§„</div>
                                        <div style="background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); padding: 12px; border-radius: 10px; color: white; margin-top:7px;">
                                            <span style="font-weight:500;">Instagram</span><br>
                                            <span style="background:rgba(255,255,255,0.15); padding:7px 10px; border-radius:7px; display:inline-block; margin-top:8px;">ğŸ“¹ <strong>hxojxxë‹˜</strong>ì´ ë¦´ìŠ¤ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤!</span>
                                        </div>
                                    </div>
                                </div>
                                <div style="font-size: 10px; margin-top: 10px; text-align: center; opacity: 0.85;">
                                    Press Enter to continue...
                                </div>
                            `
                        });

                        // íš¨ì§„ì´ ë©”íƒ€ ë©”ì‹œì§€ (ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì „í™˜ ìš”ì²­)
                        messages.push({
                            html: `
                                <div class="msg-bubble npc-wugi" style="display:flex;align-items:flex-start;">
                                    <div class="npc-profile">
                                        <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23a3d8f4'/><rect x='7' y='9' width='18' height='18' fill='%23fff'/><rect x='11' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='18' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='14' y='21' width='4' height='2' fill='%23f6d7f2'/></svg>" alt="íš¨ì§„ í”„ë¡œí•„">
                                    </div>
                                    <div>
                                        <div style="font-weight: bold; color: #a3d8f4; font-size:15px;">íš¨ì§„</div>
                                        <div style="margin-top:4px; background: rgba(163, 216, 244, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #a3d8f4;">
                                            <div style="font-size: 12px; color: #666; margin-bottom: 4px;">[ì§€ê¸ˆ]</div>
                                            <div style="color: #1976d2;">ìê¾¸ ì—”í„°ã„´ ëˆŒëŸ¬ì•¼ í•˜ëŠ”ê±¸ ìŠ¤í˜ì´ìŠ¤ ë°”ë¥¼ ëˆ„ë¥´ê²Œë¼ ã…¡ã…¡ ë°”ê¿”ì¤„ ìˆ˜ ìˆë‹ˆ?</div>
                                        </div>
                                    </div>
                                </div>
                                <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                                    Press Enter to continue...
                                </div>
                            `,
                            callback: () => {
                                // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì „í™˜
                                gameState.switchedToSpace = true;
                                showSystemMessage();
                            }
                        });

                        // 2. â€˜ì—¬í–‰ê°ˆë•Œ ì¹œêµ¬ 3ëª… ë¬´ë¦¬ íŠ¹â€™ ë¦´ìŠ¤ ì†Œê°œ (ì¸ë„¤ì¼+ì• ë‹ˆ íš¨ê³¼)
                        messages.push({
                            html: `
                                <div class="msg-bubble npc-wugi" style="display:flex;align-items:flex-start;">
                                    <div class="npc-profile">
                                        <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23a3d8f4'/><rect x='7' y='9' width='18' height='18' fill='%23fff'/><rect x='11' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='18' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='14' y='21' width='4' height='2' fill='%23f6d7f2'/></svg>" alt="íš¨ì§„ í”„ë¡œí•„">
                                    </div>
                                    <div>
                                        <div style="font-weight: bold; color: #a3d8f4; font-size:15px;">íš¨ì§„</div>
                                        <div style="background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); padding: 13px; border-radius: 14px; color: white; margin-top:8px; box-shadow:0 6px 32px rgba(0,0,0,0.23);">
                                            <div style="font-size:15px; font-weight:bold; margin-bottom:7px; line-height:1.3;">
                                                <span style="background:rgba(0,0,0,0.11); padding:5px 12px; border-radius:9px; font-weight:700; font-size:16px;">
                                                    ì—¬í–‰ê°ˆë•Œ ì¹œêµ¬ 3ëª… ë¬´ë¦¬ íŠ¹
                                                </span>
                                            </div>
                                            <img src="https://images.unsplash.com/photo-1529156069898-49953e39b3ac?fit=crop&w=400&q=80"
                                                style="width:100%; border-radius:10px; margin:5px 0 8px 0; box-shadow:0 2px 16px #0005; aspect-ratio:4/3; object-fit:cover; animation: pulseThumb 1.2s infinite alternate;">
                                            <div style="margin-top: 6px; font-size:13px; color:#ffe;">
                                                #ì—¬í–‰ìŠ¤íƒ€ê·¸ë¨ #ì¹œêµ¬ë¬´ë¦¬ #ì›ƒê¸´ì˜ìƒ
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <style>
                                @keyframes pulseThumb { 0%{filter:brightness(0.95);} 100%{filter:brightness(1.07) drop-shadow(0 0 12px #fff3);} }
                                </style>
                                <div style="font-size: 10.5px; margin-top: 9px; text-align: center; opacity: 0.83;">
                                    Press Enter to continue...
                                </div>
                            `
                        });

                        // íš¨ì§„ì´ ë©”íƒ€ ë©”ì‹œì§€ (ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì „í™˜ ìš”ì²­)
                        messages.push({
                            html: `
                                <div class="msg-bubble npc-wugi" style="display:flex;align-items:flex-start;">
                                    <div class="npc-profile">
                                        <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23a3d8f4'/><rect x='7' y='9' width='18' height='18' fill='%23fff'/><rect x='11' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='18' y='14' width='3' height='3' fill='%2386a8e7'/><rect x='14' y='21' width='4' height='2' fill='%23f6d7f2'/></svg>" alt="íš¨ì§„ í”„ë¡œí•„">
                                    </div>
                                    <div>
                                        <div style="font-weight: bold; color: #a3d8f4; font-size:15px;">íš¨ì§„</div>
                                        <div style="margin-top:4px; background: rgba(163, 216, 244, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #a3d8f4;">
                                            <div style="font-size: 12px; color: #FFF; margin-bottom: 4px;">[ì§€ê¸ˆ]</div>
                                            <div style="color: #FFF;">ìê¾¸ ì—”í„°ã„´ ëˆŒëŸ¬ì•¼ í•˜ëŠ”ê±¸ ìŠ¤í˜ì´ìŠ¤ ë°”ë¥¼ ëˆ„ë¥´ê²Œ ë¼ ã…¡ã…¡ ë°”ê¿”ì¤„ ìˆ˜ ìˆë‹ˆ?</div>
                                        </div>
                                    </div>
                                </div>
                                <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                                    Press Enter to continue...
                                </div>
                            `,
                            callback: () => {
                                // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì „í™˜
                                gameState.switchedToSpace = true;
                                showSystemMessage();
                            }
                        });
                    }


                    // ì´ì˜ˆì§€ ë¶ˆí‰ ë©”ì‹œì§€ (í•œ ë²ˆë§Œ í‘œì‹œ)
                    if (!gameState.yejiComplaintShown) {
                        gameState.yejiComplaintShown = true;
                        messages.push({
                            html: `
                                <div class="msg-bubble npc-yeji" style="display:flex;align-items:flex-start;">
                                    <div class="npc-profile">
                                        <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23e74c3c'/><rect x='7' y='10' width='18' height='17' fill='%23fff6f3'/><rect x='11' y='16' width='3' height='3' fill='%23c73a3a'/><rect x='18' y='16' width='3' height='3' fill='%23c73a3a'/><rect x='14' y='24' width='4' height='2' fill='%23e8c4d7'/></svg>" alt="ì´ì˜ˆì§€ í”„ë¡œí•„">
                                    </div>
                                    <div>
                                        <div style="font-weight: bold; color: #e74c3c; font-size:15px;">ì´ì˜ˆì§€ (ê³ ë“±í•™êµ ì¹œêµ¬)</div>
                                        <div style="margin-top:4px; background: rgba(231, 76, 60, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #e74c3c;">
                                            "ì•¼! ì €ê¸°ì„œ ë°©í–¥í‚¤ í•œë²ˆ ëˆ„ë¥´ë©´ ì €ê¸°ë¡œ ê°€ì§€ëŠ”ë° ì–´ì¼€ ë¨¹ìœ¼ë¼ëŠ” ê±°ì£ ? ê°œë°œì ëˆ„ê³ ? ğŸ˜¤"
                                        </div>
                                        <div style="font-size: 11px; color: #7f8c8d; margin-top: 7px;">
                                            * ê³ ë“±í•™êµ ë•Œë¶€í„° ë´ì˜¨ ì¹œêµ¬ ì´ì˜ˆì§€ê°€ ê²Œì„ ì¡°ì‘ì— ëŒ€í•´ ë¶ˆë§Œì„ í‘œí–ˆìŠµë‹ˆë‹¤ !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                                        </div>
                                    </div>
                                </div>
                                <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                                    Press Enter to continue...
                                </div>
                            `
                        });
                    }

                    // ë©”ì‹œì§€ í ì‹œì‘
                    addToMessageQueue(messages);

                    // ë¥˜ì‹œìš± NPC ëŒ€ì‚¬ (ë”´ìƒê° 2ê°œì¼ ë•Œ 1ë²ˆë§Œ)
                    if (gameState.collectedEmotions.length === 2 && !gameState.ryuEventTriggered) {
                        gameState.ryuEventTriggered = true;
                        addToMessageQueue([
                            {
                                html: `
                                    <div class="msg-bubble npc-ryu" style="display:flex;align-items:flex-start;">
                                        <div class="npc-profile">
                                            <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%2334495e'/><rect x='7' y='9' width='18' height='18' fill='%23fff'/><rect x='11' y='14' width='3' height='3' fill='%232c3e50'/><rect x='18' y='14' width='3' height='3' fill='%232c3e50'/><rect x='13' y='21' width='6' height='2' fill='%23e67e22'/></svg>" alt="ë¥˜ì‹œìš± í”„ë¡œí•„">
                                        </div>
                                        <div>
                                            <div style="font-weight: bold; color: #34495e; font-size:15px;">ë¥˜ì‹œìš±</div>
                                            <div style="margin-top:4px; background: rgba(52, 73, 94, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #34495e;">
                                                <div style="font-size: 12px; color: #666; margin-bottom: 4px;">[ì˜¤í›„ 12:30]</div>
                                                <div style="color: #2c3e50;">ì ì‹¬ ë­ë¨¹ì§€? ê°™ì´ ë¨¹ì„ì‚¬ëŒ?</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                                        Press Enter to continue...
                                    </div>
                                `
                            }
                        ]);
                    }

                    updateEmotionList();
                    updateProgress();
                    updateTime();
                }
            });
        }

        // ì‚¬ë¬´ì‹¤ ë„ë‹¬ ì²´í¬
        function checkOfficeReached() {
            if (gameMap[gameState.player.y][gameState.player.x] === 3) {
                if (gameState.collectedEmotions.length === gameState.totalEmotions) {
                    gameState.gameComplete = true;
                    showYejiHugMessage();
                } else {
                    addToMessageQueue([{
                        html: `
                            <div class="msg-bubble npc-system">
                                <div style="font-weight: bold; color: #e67e22;">SYSTEM</div>
                                <div style="margin-top:7px;">
                                    ğŸ¢ ì‚¬ë¬´ì‹¤ì— ë„ì°©í–ˆì§€ë§Œ... ë”´ìƒê°ì´ ë¶€ì¡±í•´ì„œ ë­”ê°€ ì•„ì‰½ë„¤ìš”.<br>
                                    <span style="color:#e67e22;">(${gameState.collectedEmotions.length}/${gameState.totalEmotions})</span><br><br>
                                    ğŸ˜… ë‹¤ì‹œ ì¶œê·¼ê¸¸ë¡œ ëŒì•„ê°€ì„œ ë”´ìƒê°ì„ ë” ëª¨ì•„ë³´ì„¸ìš”!
                                </div>
                            </div>
                            <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                                Press Enter to continue...
                            </div>
                        `,
                        callback: () => {
                            // í”Œë ˆì´ì–´ë¥¼ ë‹¤ì‹œ ì¶œê·¼ê¸¸ ì‹œì‘ì ìœ¼ë¡œ ì´ë™
                            gameState.player.x = 12;
                            gameState.player.y = 17;
                            updatePlayerPosition();
                        }
                    }]);
                }
            }
        }

        // ì´ì˜ˆì§€ ì•ˆì•„ì£¼ê¸° ë©”ì‹œì§€
        function showYejiHugMessage() {
            addToMessageQueue([
                {
                    html: `
                        <div class="msg-bubble npc-yeji" style="display:flex;align-items:flex-start;">
                            <div class="npc-profile">
                                <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23e74c3c'/><rect x='7' y='10' width='18' height='17' fill='%23fff6f3'/><rect x='11' y='16' width='3' height='3' fill='%23c73a3a'/><rect x='18' y='16' width='3' height='3' fill='%23c73a3a'/><rect x='14' y='24' width='4' height='2' fill='%23e8c4d7'/></svg>" alt="ì´ì˜ˆì§€ í”„ë¡œí•„">
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #e74c3c; font-size:15px;">ê¹€í˜„ì§„</div>
                                <div style="background: rgba(231, 76, 60, 0.10); padding: 15px; border-radius: 7px; border-left: 4px solid #e74c3c; text-align: center; margin-top:6px;">
                                    <div style="font-size: 22px; margin-bottom: 6px;">ğŸ¤—ğŸ’•</div>
                                    <div style="font-weight: bold; color: #e74c3c;">"ê³ ìƒí–ˆì–´! ì˜¤ëŠ˜ë„ ì¶œê·¼ ì„±ê³µ!"</div>
                                    <div style="margin-top: 7px; font-size: 14px;">*ê¹€í˜„ì§„ì´ ë”°ëœ»í•˜ê²Œ ì•ˆì•„ì¤ë‹ˆë‹¤*</div>
                                </div>
                                <div style="font-size: 12px; color: #27ae60; margin-top: 13px; text-align: center;">
                                    ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë”´ìƒê°ì„ ìˆ˜ì§‘í•˜ë©° ë¬´ì‚¬íˆ ì¶œê·¼ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰
                                </div>
                        </div>
                    </div>
                    <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                        Press Enter to continue...
                    </div>
                `
                },
                {
                    html: `
                        <div class="msg-bubble npc-system">
                            <div style="font-weight: bold; color: #3498db;">SYSTEM</div>
                            <div style="margin-top:7px;">
                                ğŸ¢ ì´ì œ íšŒì‚¬ ë‚´ë¶€ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤...<br>
                                ìë¦¬ì— ì•‰ì•„ì„œ í•˜ë£¨ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `,
                    callback: () => {
                        // íšŒì‚¬ë¡œ ì´ë™ (íšŒì‚¬ ë§µì˜ ì…êµ¬ì¸ 1ë²ˆ íƒ€ì¼ë¡œ)
                        gameState.inOffice = true;
                        gameState.player.x = 12;
                        gameState.player.y = 16;
                        initOfficeEmotions();
                        document.getElementById('playerPos').textContent = 'íšŒì‚¬ ë¡œë¹„ ğŸ¢';
                    }
                }
            ]);
        }

        // PC ì¸í„°ë™ì…˜ ì²´í¬
        function checkPCInteraction() {
            if (gameState.inOffice && 
                officeMap[gameState.player.y][gameState.player.x] === 11) {
                if (!gameState.pcOn) {
                    turnOnPC();
                } else if (!gameState.messengerOpen) {
                    openMessenger();
                }
            } else if (gameState.inOffice) {
                // ë‚´ ìë¦¬ê°€ ì•„ë‹Œ ê³³ì—ì„œ ì—”í„°ë¥¼ ëˆŒë €ì„ ë•Œ
                addToMessageQueue([{
                    html: `
                        <div class="msg-bubble npc-system">
                            <div style="font-weight: bold; color: #95a5a6;">SYSTEM</div>
                            <div style="margin-top:7px;">
                                ğŸ’» ë‚´ ìë¦¬ë¡œ ê°€ì„œ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ PCë¥¼ ì‚¬ìš©í•˜ì„¸ìš”!<br>
                                (ğŸ’» ì•„ì´ì½˜ì´ ìˆëŠ” ì±…ìƒì„ ì°¾ì•„ë³´ì„¸ìš”)
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `
                }]);
            }
        }

        // PC ì¼œê¸°
        function turnOnPC() {
            gameState.pcOn = true;
            addToMessageQueue([{
                html: `
                    <div class="msg-bubble npc-system">
                        <div style="font-weight: bold; color: #3498db;">SYSTEM</div>
                        <div style="margin-top:7px;">
                            ğŸ’» PCê°€ ë¶€íŒ…ì¤‘ì…ë‹ˆë‹¤...<br>
                            <div style="margin-top: 10px; text-align: center;">
                                <div style="font-family: monospace; color: #00ff00; background: #000; padding: 10px; border-radius: 4px;">
                                    Windows Starting...<br>
                                    Loading system files...<br>
                                    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%<br>
                                    Ready!
                                </div>
                            </div>
                            ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ë‹¤ì‹œ ëˆŒëŸ¬ ë©”ì‹ ì €ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”!
                        </div>
                    </div>
                    <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                        Press Enter to continue...
                    </div>
                `
            }]);
        }

        // ë©”ì‹ ì € ì—´ê¸°
        function openMessenger() {
            gameState.messengerOpen = true;
            addToMessageQueue([{
                html: `
                    <div class="msg-bubble npc-system">
                        <div style="font-weight: bold; color: #3498db;">SYSTEM</div>
                        <div style="margin-top:7px;">
                            ğŸ’¬ ë©”ì‹ ì €ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤...<br>
                            ìƒˆë¡œìš´ ë©”ì‹œì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤!
                        </div>
                    </div>
                    <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                        Press Enter to continue...
                    </div>
                `,
                callback: () => {
                    startChatWithSua();
                }
            }]);
        }

        // ë°•ìˆ˜ì•„ì™€ì˜ ì±„íŒ… ì‹œì‘
        function startChatWithSua() {
            gameState.chatWithSua = true;
            addToMessageQueue([
                {
                    html: `
                        <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 10px; padding: 15px; font-family: 'Arial', sans-serif;">
                            <div style="background: #007bff; color: white; padding: 8px; border-radius: 8px 8px 0 0; margin: -15px -15px 10px -15px; font-weight: bold;">
                                ğŸ“± ë©”ì‹ ì € - ë°•ìˆ˜ì•„
                            </div>
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 15px 15px 15px 5px; margin-bottom: 8px; position: relative;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ë°•ìˆ˜ì•„ [ì˜¤í›„ 4:16]</div>
                                <div style="color: #1976d2; font-weight: bold;">ìª¼ì•„ì‰</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 15px 15px 15px 5px; margin-bottom: 8px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ë°•ìˆ˜ì•„ [ì˜¤í›„ 4:16]</div>
                                <div style="color: #1976d2;">í• ì¼ ê±°ì˜ ë‹¤ ë‡ë‚œëŠ”ë°</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 15px 15px 15px 5px; margin-bottom: 15px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ë°•ìˆ˜ì•„ [ì˜¤í›„ 4:16]</div>
                                <div style="color: #1976d2;">ë„ˆëª¨ì¡¸ë ¤</div>
                            </div>
                            <div style="text-align: center; font-size: 12px; color: #666;">
                                ë‹µì¥í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”
                            </div>
                        </div>
                    `
                },
                {
                    html: `
                        <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 10px; padding: 15px; font-family: 'Arial', sans-serif;">
                            <div style="background: #007bff; color: white; padding: 8px; border-radius: 8px 8px 0 0; margin: -15px -15px 10px -15px; font-weight: bold;">
                                ğŸ“± ë©”ì‹ ì € - ë°•ìˆ˜ì•„
                            </div>
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 15px 15px 15px 5px; margin-bottom: 8px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ë°•ìˆ˜ì•„ [ì˜¤í›„ 4:16]</div>
                                <div style="color: #1976d2; font-weight: bold;">ìª¼ì•„ì‰</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 15px 15px 15px 5px; margin-bottom: 8px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ë°•ìˆ˜ì•„ [ì˜¤í›„ 4:16]</div>
                                <div style="color: #1976d2;">í• ì¼ ê±°ì˜ ë‹¤ ë‡ë‚œëŠ”ë°</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 15px 15px 15px 5px; margin-bottom: 8px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ë°•ìˆ˜ì•„ [ì˜¤í›„ 4:16]</div>
                                <div style="color: #1976d2;">ë„ˆëª¨ì¡¸ë ¤</div>
                            </div>
                            <div style="background: #dcf8c6; padding: 12px; border-radius: 15px 15px 5px 15px; margin-left: 40px; margin-bottom: 15px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 4px; text-align: right;">ë‚˜ [ì˜¤í›„ 4:17]</div>
                                <div style="color: #2e7d32;">ìë©´ ì•ˆë¼..(ì)</div>
                            </div>
                            <div style="text-align: center; font-size: 12px; color: #666;">
                                ë‹µì¥ì„ ë³´ëƒˆìŠµë‹ˆë‹¤!
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `,
                    callback: () => {
                        // ë°•ìˆ˜ì•„ì™€ì˜ ì±„íŒ… ì™„ë£Œ í›„ ê¹€ì±„ì±„ ë“±ì¥
                        setTimeout(() => {
                            startChaecheEvent();
                        }, 1000);
                    }
                }
            ]);
        }

        // íšŒì‚¬ ê°ì • ì´ˆê¸°í™”
        function initOfficeEmotions() {
            // íšŒì‚¬ì—ì„œ ìˆ˜ì§‘í•  ìˆ˜ ìˆëŠ” ê°ì •ë“¤ ì¶”ê°€
            const officeEmotionPositions = [
                {x: 5, y: 5}, {x: 15, y: 8}, {x: 8, y: 11}, 
                {x: 20, y: 6}, {x: 12, y: 4}
            ];
            
            officeEmotionPositions.forEach((pos, index) => {
                if (index < officeEmotionTypes.length) {
                    const emotion = {
                        ...officeEmotionTypes[index],
                        x: pos.x,
                        y: pos.y,
                        collected: false
                    };
                    gameState.emotions.push(emotion);
                }
            });
            
            // ì´ ê°ì • ìˆ˜ ì—…ë°ì´íŠ¸
            gameState.totalEmotions = gameState.emotions.length;
            updateEmotionList();
            updateProgress();
        }

        // ê¹€ì±„ì±„ NPC ì´ë²¤íŠ¸
        function startChaecheEvent() {
            // í”Œë ˆì´ì–´ ì›€ì§ì„ ì¼ì‹œ ì •ì§€
            window.movePlayerEnabled = false;
            
            // ê¹€ì±„ì±„ NPC ë“±ì¥ (í™”ë©´ ì˜¤ë¥¸ìª½ì—ì„œ ë“±ì¥)
            gameState.chaecheNPC = {
                x: 24,
                y: 11,
                targetX: 15,
                char: 'ğŸ‘©â€ğŸ’¼',
                moving: true
            };
            
            // NPC ì´ë™ ì• ë‹ˆë©”ì´ì…˜
            const moveInterval = setInterval(() => {
                if (gameState.chaecheNPC.x > gameState.chaecheNPC.targetX) {
                    gameState.chaecheNPC.x--;
                } else {
                    clearInterval(moveInterval);
                    gameState.chaecheNPC.moving = false;
                    startChaecheMessages();
                }
            }, 200);
        }

        // ê¹€ì±„ì±„ ë©”ì‹œì§€ ì‹œì‘
        function startChaecheMessages() {
            addToMessageQueue([
                {
                    html: `
                        <div class="msg-bubble npc-chaeche" style="display:flex;align-items:flex-start;">
                            <div class="npc-profile">
                                <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23ff6b9d'/><rect x='7' y='10' width='18' height='17' fill='%23fff'/><rect x='11' y='16' width='3' height='3' fill='%23ff1744'/><rect x='18' y='16' width='3' height='3' fill='%23ff1744'/><rect x='14' y='22' width='4' height='2' fill='%23ff8a65'/></svg>" alt="ê¹€ì±„ì±„ í”„ë¡œí•„">
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #ff6b9d; font-size:15px;">ì±„ë¦°ì–¸ë‹ˆ (ê¹€ì±„ì±„)</div>
                                <div style="margin-top:4px; background: rgba(255, 107, 157, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #ff6b9d;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">[ì˜¤ì „ 10:40]</div>
                                    <div style="color: #ff1744;">ì•„</div>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `
                },
                {
                    html: `
                        <div class="msg-bubble npc-chaeche" style="display:flex;align-items:flex-start;">
                            <div class="npc-profile">
                                <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23ff6b9d'/><rect x='7' y='10' width='18' height='17' fill='%23fff'/><rect x='11' y='16' width='3' height='3' fill='%23ff1744'/><rect x='18' y='16' width='3' height='3' fill='%23ff1744'/><rect x='14' y='22' width='4' height='2' fill='%23ff8a65'/></svg>" alt="ê¹€ì±„ì±„ í”„ë¡œí•„">
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #ff6b9d; font-size:15px;">ì±„ë¦°ì–¸ë‹ˆ (ê¹€ì±„ì±„)</div>
                                <div style="margin-top:4px; background: rgba(255, 107, 157, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #ff6b9d;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">[ì˜¤ì „ 10:40]</div>
                                    <div style="color: #ff1744;">ìˆ </div>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `
                },
                {
                    html: `
                        <div class="msg-bubble npc-chaeche" style="display:flex;align-items:flex-start;">
                            <div class="npc-profile">
                                <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23ff6b9d'/><rect x='7' y='10' width='18' height='17' fill='%23fff'/><rect x='11' y='16' width='3' height='3' fill='%23ff1744'/><rect x='18' y='16' width='3' height='3' fill='%23ff1744'/><rect x='14' y='22' width='4' height='2' fill='%23ff8a65'/></svg>" alt="ê¹€ì±„ì±„ í”„ë¡œí•„">
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #ff6b9d; font-size:15px;">ì±„ë¦°ì–¸ë‹ˆ (ê¹€ì±„ì±„)</div>
                                <div style="margin-top:4px; background: rgba(255, 107, 157, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #ff6b9d;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">[ì˜¤ì „ 10:40]</div>
                                    <div style="color: #ff1744;">ì¡¸ë¼ì•ˆê¹¨ë„¤ ã…‹ã…‹ã…‹</div>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `
                },
                {
                    html: `
                        <div class="msg-bubble npc-chaeche" style="display:flex;align-items:flex-start;">
                            <div class="npc-profile">
                                <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23ff6b9d'/><rect x='7' y='10' width='18' height='17' fill='%23fff'/><rect x='11' y='16' width='3' height='3' fill='%23ff1744'/><rect x='18' y='16' width='3' height='3' fill='%23ff1744'/><rect x='14' y='22' width='4' height='2' fill='%23ff8a65'/></svg>" alt="ê¹€ì±„ì±„ í”„ë¡œí•„">
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #ff6b9d; font-size:15px;">ì±„ë¦°ì–¸ë‹ˆ (ê¹€ì±„ì±„)</div>
                                <div style="margin-top:4px; background: rgba(255, 107, 157, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #ff6b9d;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">[ì˜¤ì „ 10:40]</div>
                                    <div style="color: #ff1744;">ì•„ ã…‹ã…‹ ã…‹ ã…‹ã…‹</div>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `
                },
                {
                    html: `
                        <div class="msg-bubble npc-chaeche" style="display:flex;align-items:flex-start;">
                            <div class="npc-profile">
                                <img src="data:image/svg+xml;utf8,<svg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><rect width='32' height='32' fill='%23ff6b9d'/><rect x='7' y='10' width='18' height='17' fill='%23fff'/><rect x='11' y='16' width='3' height='3' fill='%23ff1744'/><rect x='18' y='16' width='3' height='3' fill='%23ff1744'/><rect x='14' y='22' width='4' height='2' fill='%23ff8a65'/></svg>" alt="ê¹€ì±„ì±„ í”„ë¡œí•„">
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #ff6b9d; font-size:15px;">ì±„ë¦°ì–¸ë‹ˆ (ê¹€ì±„ì±„)</div>
                                <div style="margin-top:4px; background: rgba(255, 107, 157, 0.10); padding: 12px; border-radius: 8px; border-left: 4px solid #ff6b9d;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">[ì˜¤ì „ 10:40]</div>
                                    <div style="color: #ff1744;">ë””ì§ˆê±°ê°™ì•„ì•„ì§ë„</div>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `
                },
                {
                    html: `
                        <div class="msg-bubble npc-system">
                            <div style="font-weight: bold; color: #95a5a6;">SYSTEM</div>
                            <div style="margin-top:7px;">
                                ğŸ‘‹ ê¹€ì±„ì±„ê°€ í‡´ì¥í–ˆìŠµë‹ˆë‹¤...<br>
                                ì´ì œ ë‹¤ì‹œ ì›€ì§ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                            </div>
                        </div>
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                            Press Enter to continue...
                        </div>
                    `,
                    callback: () => {
                        // ê¹€ì±„ì±„ í‡´ì¥ ì• ë‹ˆë©”ì´ì…˜
                        if (gameState.chaecheNPC) {
                            gameState.chaecheNPC.moving = true;
                            const exitInterval = setInterval(() => {
                                gameState.chaecheNPC.x++;
                                if (gameState.chaecheNPC.x > 25) {
                                    clearInterval(exitInterval);
                                    gameState.chaecheNPC = null;
                                    // í”Œë ˆì´ì–´ ì›€ì§ì„ ì¬ê°œ
                                    window.movePlayerEnabled = true;
                                }
                            }, 200);
                        } else {
                            window.movePlayerEnabled = true;
                        }
                    }
                }
            ]);
        }

        // ì‹œìŠ¤í…œ ìˆ˜ì • ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
        function showSystemMessage() {
            const messageBox = document.getElementById('messageBox');
            messageBox.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; 
                            padding: 40px 50px; border-radius: 20px; 
                            font-size: 32px; font-weight: bold; text-align: center; z-index: 1000;
                            box-shadow: 0 20px 60px rgba(0,0,0,0.4); border: 4px solid #fff;
                            animation: bounceIn 0.6s ease-out;">
                    ğŸ”„ ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë³€ê²½ ì™„ë£Œ! ğŸ”„<br>
                    <div style="font-size: 20px; margin-top: 15px; font-weight: normal; line-height: 1.4;">
                        ì´ì œë¶€í„° ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë°”ë€ë‹ˆë‹¤!<br>
                        <span style="color: #FFD700; font-weight: bold;">SPACE BAR</span>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš” âœ¨
                    </div>
                </div>
                <style>
                    @keyframes bounceIn {
                        0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.1); }
                        100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    }
                </style>
            `;
            messageBox.style.display = 'block';
            
            // ëª¨ë“  ê¸°ì¡´ ë©”ì‹œì§€ë¥¼ ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë³€ê²½
            updateAllMessagesToSpace();
            
            // 4ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§
            setTimeout(() => {
                messageBox.style.display = 'none';
                isShowingMessage = false;
            }, 4000);
        }

        // ëª¨ë“  ë©”ì‹œì§€ë¥¼ ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë³€ê²½
        function updateAllMessagesToSpace() {
            // ì´í›„ ëª¨ë“  ë©”ì‹œì§€ì—ì„œ "Press Enter"ë¥¼ "Press Space"ë¡œ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
            // ì‹¤ì œë¡œëŠ” gameState.switchedToSpace í”Œë˜ê·¸ë¡œ ì œì–´ë¨
        }

        // ìŠ¤í˜ì´ìŠ¤ë°” ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
        let interactionMessageShown = false;
        function showPCInteractionMessage(message) {
            if (!interactionMessageShown && !isShowingMessage) {
                const messageBox = document.getElementById('messageBox');
                messageBox.innerHTML = `
                    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                                background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 10px; 
                                font-size: 18px; font-weight: bold; text-align: center; z-index: 1000;">
                        ${message}
                    </div>
                `;
                messageBox.style.display = 'block';
                interactionMessageShown = true;
                
                // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§
                setTimeout(() => {
                    if (!isShowingMessage) {
                        messageBox.style.display = 'none';
                        interactionMessageShown = false;
                    }
                }, 3000);
            }
        }

        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updatePlayerPosition() {
            const pos = document.getElementById('playerPos');
            if (gameState.inOffice) {
                const currentTile = officeMap[gameState.player.y][gameState.player.x];
                let location = '';
                if (currentTile === 11) {
                    if (!gameState.pcOn) {
                        location = 'ë‚´ ìë¦¬ ğŸ’»';
                        showPCInteractionMessage('ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ í´ë¦­í•´ì„œ PCë¥¼ ì¼œì„¸ìš”!');
                    } else if (!gameState.messengerOpen) {
                        location = 'ë‚´ ìë¦¬ ğŸ’»';
                        showPCInteractionMessage('ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ í´ë¦­í•´ì„œ ë©”ì‹ ì €ë¥¼ ì—´ì–´ì£¼ì„¸ìš”!');
                    } else {
                        location = 'ë‚´ ìë¦¬ ğŸ’»';
                    }
                }
                else if (currentTile === 10) location = 'íšŒì‚¬ ì±…ìƒ ğŸ“‹';
                else if (currentTile === 12) location = 'ë³µì‚¬ê¸° ğŸ–¨ï¸';
                else if (currentTile === 13) location = 'í™”ì¥ì‹¤ ğŸš»';
                else if (currentTile === 14) location = 'íšŒì˜ì‹¤ ğŸ¢';
                else location = 'íšŒì‚¬ ğŸ¢';
                pos.textContent = location;
            } else {
                const currentTile = gameMap[gameState.player.y][gameState.player.x];
                let location = '';
                if (currentTile === 4) location = 'ì§€í•˜ì² ì—­ ğŸš‡';
                else if (currentTile === 5) location = 'íš¡ë‹¨ë³´ë„ ğŸš¦';
                else if (currentTile === 3) location = 'ì‚¬ë¬´ì‹¤ ì• ğŸ¢';
                else if (gameState.player.y < 8) location = 'ì‚¬ë¬´ì‹¤ ê·¼ì²˜ ğŸ™ï¸';
                else if (gameState.player.y > 14) location = 'ì§€í•˜ì² ì—­ ê·¼ì²˜ ğŸš‰';
                else location = 'ì¶œê·¼ê¸¸ ì¤‘ê°„ ğŸš¶â€â™‚ï¸';
                pos.textContent = location;
            }
        }

        function updateTime() {
            const times = ['8:00 AM', '8:05 AM', '8:10 AM', '8:15 AM', '8:20 AM', '8:25 AM'];
            const timeIndex = Math.min(gameState.collectedEmotions.length, times.length - 1);
            gameState.currentTime = times[timeIndex];
            document.getElementById('timeInfo').textContent = gameState.currentTime;
        }

        function updateEmotionList() {
            const list = document.getElementById('emotionList');
            if (gameState.collectedEmotions.length === 0) {
                list.innerHTML = '<div style="color: #7f8c8d; font-size: 12px;">ì•„ì§ ë”´ìƒê°ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                list.innerHTML = gameState.collectedEmotions.map(emotion =>
                    `<div class="emotion-item">
                        <div class="emotion-icon" style="background: ${emotion.color};">${emotion.icon}</div>
                        <div>
                            <div style="font-weight: 600;">${emotion.type}</div>
                            <div style="font-size: 10px; color: #bdc3c7;">${emotion.desc}</div>
                        </div>
                    </div>`
                ).join('');
            }
            document.getElementById('collectCount').textContent =
                `${gameState.collectedEmotions.length}/${gameState.totalEmotions}`;
        }
        function updateProgress() {
            const progress = (gameState.collectedEmotions.length / gameState.totalEmotions) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // ë Œë”ë§
        function render() {
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const currentMap = gameState.inOffice ? officeMap : gameMap;
            
            for (let y = 0; y < MAP_HEIGHT; y++) {
                for (let x = 0; x < MAP_WIDTH; x++) {
                    const tileX = x * TILE_SIZE;
                    const tileY = y * TILE_SIZE;
                    switch (currentMap[y][x]) {
                        case 0:
                            ctx.fillStyle = '#34495e';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.strokeStyle = '#2c3e50';
                            ctx.strokeRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            if ((x + y) % 3 === 0) {
                                ctx.fillStyle = '#f39c12';
                                ctx.fillRect(tileX + 8, tileY + 6, 6, 6);
                                ctx.fillRect(tileX + 18, tileY + 6, 6, 6);
                                ctx.fillRect(tileX + 8, tileY + 20, 6, 6);
                                ctx.fillRect(tileX + 18, tileY + 20, 6, 6);
                            }
                            break;
                        case 1:
                            ctx.fillStyle = '#95a5a6';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.strokeStyle = '#7f8c8d';
                            ctx.strokeRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            break;
                        case 2:
                            ctx.fillStyle = '#95a5a6';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            break;
                        case 3:
                            ctx.fillStyle = '#e74c3c';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#fff';
                            ctx.font = '16px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸ¢', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 4:
                            ctx.fillStyle = '#3498db';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#fff';
                            ctx.font = '14px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸš‡', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 5:
                            ctx.fillStyle = '#34495e';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#ecf0f1';
                            for (let i = 0; i < 4; i++) {
                                ctx.fillRect(tileX + i * 8, tileY, 4, TILE_SIZE);
                            }
                            break;
                        case 6:
                            ctx.fillStyle = '#95a5a6';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.font = '20px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸŒ³', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 7);
                            break;
                        case 7:
                            ctx.fillStyle = '#8b4513';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#fff';
                            ctx.font = '14px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('â˜•', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 8:
                            ctx.fillStyle = '#27ae60';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#fff';
                            ctx.font = '14px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸª', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 9:
                            ctx.fillStyle = '#95a5a6';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#8b4513';
                            ctx.fillRect(tileX + 4, tileY + 12, TILE_SIZE - 8, 8);
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸª‘', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 3);
                            break;
                        case 10: // ì±…ìƒ
                            ctx.fillStyle = '#8B4513';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#D2B48C';
                            ctx.fillRect(tileX + 2, tileY + 2, TILE_SIZE - 4, TILE_SIZE - 4);
                            ctx.font = '16px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸ“‹', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 11: // ë‚´ ìë¦¬ (PCê°€ ìˆëŠ” ì±…ìƒ)
                            ctx.fillStyle = '#8B4513';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#D2B48C';
                            ctx.fillRect(tileX + 2, tileY + 2, TILE_SIZE - 4, TILE_SIZE - 4);
                            // PC ëª¨ë‹ˆí„° í‘œì‹œ
                            ctx.fillStyle = '#2c3e50';
                            ctx.fillRect(tileX + 8, tileY + 8, 16, 12);
                            ctx.fillStyle = gameState.pcOn ? '#00ff00' : '#333';
                            ctx.fillRect(tileX + 10, tileY + 10, 12, 8);
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸ’»', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 12: // ë³µì‚¬ê¸°
                            ctx.fillStyle = '#ecf0f1';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.font = '16px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸ–¨ï¸', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 13: // í™”ì¥ì‹¤
                            ctx.fillStyle = '#3498db';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.font = '16px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸš»', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 5);
                            break;
                        case 14: // íšŒì˜ì‹¤
                            ctx.fillStyle = '#e67e22';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#f39c12';
                            ctx.fillRect(tileX + 4, tileY + 12, TILE_SIZE - 8, 8);
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸ¢', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 3);
                            break;
                    }
                }
            }
            gameState.emotions.forEach(emotion => {
                if (!emotion.collected) {
                    const x = emotion.x * TILE_SIZE;
                    const y = emotion.y * TILE_SIZE;
                    const time = Date.now() * 0.003;
                    const bounce = Math.sin(time + emotion.x + emotion.y) * 3;
                    const glow = Math.sin(time * 2 + emotion.x + emotion.y) * 0.3 + 0.7;
                    ctx.save();
                    ctx.globalAlpha = glow;
                    ctx.fillStyle = emotion.color;
                    ctx.fillRect(x + 2, y + 2 + bounce, TILE_SIZE - 4, TILE_SIZE - 4);
                    ctx.globalAlpha = 1;
                    ctx.strokeStyle = emotion.color;
                    ctx.lineWidth = 3;
                    ctx.strokeRect(x + 2, y + 2 + bounce, TILE_SIZE - 4, TILE_SIZE - 4);
                    ctx.font = '18px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillStyle = '#fff';
                    ctx.fillText(emotion.icon, x + TILE_SIZE/2, y + TILE_SIZE/2 + 5 + bounce);
                    ctx.restore();
                }
            });
            const playerX = gameState.player.x * TILE_SIZE;
            const playerY = gameState.player.y * TILE_SIZE;
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(playerX + 2, playerY + 28, TILE_SIZE - 4, 4);
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#2c3e50';
            ctx.fillText(gameState.player.char, playerX + TILE_SIZE/2, playerY + TILE_SIZE/2 + 8);
            
            // ê¹€ì±„ì±„ NPC ë Œë”ë§
            if (gameState.chaecheNPC) {
                const npcX = gameState.chaecheNPC.x * TILE_SIZE;
                const npcY = gameState.chaecheNPC.y * TILE_SIZE;
                
                // NPC ê·¸ë¦¼ì
                ctx.fillStyle = 'rgba(0,0,0,0.3)';
                ctx.fillRect(npcX + 2, npcY + 28, TILE_SIZE - 4, 4);
                
                // NPC ìºë¦­í„°
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillStyle = '#ff6b9d';
                ctx.fillText(gameState.chaecheNPC.char, npcX + TILE_SIZE/2, npcY + TILE_SIZE/2 + 8);
            }
            const gradient = ctx.createRadialGradient(
                playerX + TILE_SIZE/2, playerY + TILE_SIZE/2, 0,
                playerX + TILE_SIZE/2, playerY + TILE_SIZE/2, TILE_SIZE * 2.5
            );
            gradient.addColorStop(0, 'rgba(52, 152, 219, 0.2)');
            gradient.addColorStop(1, 'rgba(52, 152, 219, 0)');
            ctx.fillStyle = gradient;
            ctx.fillRect(playerX - TILE_SIZE*1.5, playerY - TILE_SIZE*1.5, TILE_SIZE * 4, TILE_SIZE * 4);
            ctx.font = '16px Arial';
            ctx.fillStyle = '#ecf0f1';
            ctx.textAlign = 'left';
            ctx.fillText(`â° ${gameState.currentTime}`, 10, 30);
            ctx.font = '14px Arial';
            ctx.fillStyle = '#3498db';
            ctx.fillText(`ğŸ“ í˜„ì¬ ìœ„ì¹˜: ${document.getElementById('playerPos').textContent}`, 10, 55);
        }

        function gameLoop() {
            // íšŒì‚¬ì— ìˆê±°ë‚˜ ê²Œì„ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì›€ì§ì„ í—ˆìš©
            if (!gameState.gameComplete || gameState.inOffice) movePlayer();
            render();
            requestAnimationFrame(gameLoop);
        }

        // ê²Œì„ ì´ˆê¸°í™” ë° ì‹œì‘
        initEmotions();
        updateEmotionList();
        updateProgress();
        updateTime();
        // ì‹œì‘ ë©”ì‹œì§€ (ì‹œìŠ¤í…œ ë§í’ì„ )
        addToMessageQueue([{
            html: `
                <div class="msg-bubble npc-system">
                    <div style="font-weight: bold; color: #3498db;">SYSTEM</div>
                    <div style="margin-top:8px;">ë”´ìƒê° ê¸ˆì§€êµ¬ì—­ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!<br>
                    ì§€í•˜ì² ì—­ì—ì„œ ì‚¬ë¬´ì‹¤ê¹Œì§€ ì¶œê·¼ê¸¸ì„ ê±¸ìœ¼ë©°<br>
                    ì†Œì¤‘í•œ ë”´ìƒê°ë“¤ì„ ìˆ˜ì§‘í•´ë³´ì„¸ìš” ğŸ’­</div>
                    <div style="font-size: 12px; color: #7f8c8d; margin-top: 13px;">í™”ì‚´í‘œ í‚¤ë¡œ ì´ë™, Enterë¡œ ë©”ì‹œì§€ ë„˜ê¸°ê¸°</div>
                </div>
                <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px; text-align: center;">
                    Press Enter to start...
                </div>
            `
        }]);
        gameLoop();
    </script>
</body>
</html>
